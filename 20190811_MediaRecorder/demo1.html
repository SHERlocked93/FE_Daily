<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>å¾®ä¿¡è¯­éŸ³</title>
    <link rel="stylesheet" href="./demo1.css">
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            const oSendBtn = document.getElementById('sendBtn')
            const soundClips = document.querySelector('.sound-clips')
            let mediaRecorder
            const oChatList = document.getElementById('chatList')
            navigator.getUserMedia = (navigator.getUserMedia ||
              navigator.webkitGetUserMedia ||
              navigator.mozGetUserMedia ||
              navigator.msGetUserMedia)
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ audio: true })
                  .then(function(stream) {
                      console.log('è·å–streamï¼š')
                      console.log(stream)
                      rec(stream)
                  })
                  .catch(function(err) {
                        console.error('é”™è¯¯å•¦ ' + err)
                    }
                  )
            } else {
                console.error('ä¸æ”¯æŒ navigator.mediaDevices çš„ç¯å¢ƒ')
            }
            
            function rec(stream) {
                mediaRecorder = new MediaRecorder(stream)
                oSendBtn.addEventListener('touchstart', function(ev) {
                    ev.preventDefault()
                    this.innerHTML = 'æ¾å¼€ ç»“æŸ'
                    this.classList.add('activeBtn')
                    console.log('å¼€å§‹è®°å½•')
                    mediaRecorder.start()
                }, false)
                oSendBtn.addEventListener('touchend', function(ev) {
                    ev.preventDefault()
                    this.innerHTML = 'æŒ‰ä¸‹ è¯´è¯'
                    this.classList.remove('activeBtn')
                    mediaRecorder.stop()
                }, false)
                mediaRecorder.ondataavailable = function(e) {
                    console.log('ondataavailableï¼š ')
                    console.log(e)
                    const clipContainer = document.createElement('li')
                    const audio = document.createElement('audio')
                    clipContainer.classList.add('item_audio')
                    clipContainer.innerHTML = `
                    <div class = "redDot"></div>
                    <div class="chatContent">
                        <i class="material-icons material-icons_wifi">ğŸ™ƒ</i>
                        <span class="bot"></span>
                        <span class="top"></span>
                    </div>
                    <div class="avatar">
                        <img src="https://i.loli.net/2019/08/09/sqnjmxSZBdPfNtb.jpg" alt="">
                    </div>`
                    audio.setAttribute('controls', '')
                    oChatList.appendChild(clipContainer)
                    const audioURL = window.URL.createObjectURL(e.data)
                    audio.src = audioURL
                    oChatList.addEventListener('touchstart', function(ev) {
                        if (ev.srcElement.parentNode.className !== 'item_audio') return
                        audio.play()
                        ev.srcElement.parentNode.removeChild(ev.srcElement.parentNode.children[0])
                    }, false)
                }
            }
        }, false)
    </script>
</head>
â€‹
<body>
    <div id="wrap">
        <header id="header">
            <div id="left">
                <i class="material-icons"><</i>
                å¾®ä¿¡(184)
            </div>
            <div id="mid">è‰¾è¾¾Â·ç‹</div>
            <div id="right">
                <i class="material-icons">ğŸ˜</i>
            </div>
        </header>
        <div id="contentWrap">
            <ul id="chatList">
                <li class="item_me">
                    <div class="chatContent">æˆ‘æ˜¯ä¸æ˜¯ä½ æœ€ç–¼çˆ±çš„äºº?
                        <span class="bot"></span>
                        <span class="top"></span>
                    </div>
                    <div class="avatar">
                        <img src="https://i.loli.net/2019/08/09/sqnjmxSZBdPfNtb.jpg" alt="">
                    </div>
                </li>
                <li class="item_you">
                    <div class="avatar">
                        <img src="https://i.loli.net/2019/08/09/sqnjmxSZBdPfNtb.jpg" alt="">
                    </div>
                    <div class="chatContent">å¥”è·‘å§ï¼Œå…„å¼Ÿï¼ï¼ˆæ»šçŠŠå­ï¼‰
                        <span class="bot"></span>
                        <span class="top"></span>
                    </div>
                    â€‹
                </li>
                <li class="item_me">
                    <div class="chatContent">è¿™é‡Œæˆ‘å°±ä¸å¤šè¯´äº†ï¼Œä¸Šæ¥å°±æ˜¯ä¸€æ¢­å­ä»£ç â€¦â€¦
                        <span class="bot"></span>
                        <span class="top"></span>
                    </div>
                    <div class="avatar">
                        <img src="https://i.loli.net/2019/08/09/sqnjmxSZBdPfNtb.jpg" alt="">
                    </div>
                </li>
                <li class="item_you">
                    <div class="avatar">
                        <img src="https://i.loli.net/2019/08/09/sqnjmxSZBdPfNtb.jpg" alt="">
                    </div>
                    <div class="chatContent">å¤§å½¬å“¥ï¼Œä½ è¯´ä½ å’‹è¿™ä¹ˆä¼˜ç§€å‘¢ï¼Ÿçœ‹è§ä½ æˆ‘æœ‰ä¸€ç§å¤§æµ·çš„æ„Ÿè§‰
                        <span class="bot"></span>
                        <span class="top"></span>
                    </div>
                    â€‹
                </li>
                <li class="item_me">
                    <div class="chatContent">è€å¦¹å„¿ï¼Œä½ æ˜¯ä¸æ˜¯å–œæ¬¢ä¸Šæˆ‘äº†å‘¢â€¦â€¦
                        <span class="bot"></span>
                        <span class="top"></span>
                    </div>
                    <div class="avatar">
                        <img src="https://i.loli.net/2019/08/09/sqnjmxSZBdPfNtb.jpg" alt="">
                    </div>
                </li>
                <li class="item_you">
                    <div class="avatar">
                        <img src="https://i.loli.net/2019/08/09/sqnjmxSZBdPfNtb.jpg" alt="">
                    </div>
                    <div class="chatContent">ä¸æ˜¯ï¼Œæˆ‘æ™•èˆ¹ï¼Œçœ‹è§ä½ æƒ³åâ€¦â€¦
                        <span class="bot"></span>
                        <span class="top"></span>
                    </div>
                    â€‹
                </li>
            </ul>
        </div>
        <footer id="footer">
            <div id="keyboard">
                <i class="material-icons">âŒ¨ï¸</i>
            </div>
            <div id="sayBtn">
                <span id="sendBtn" class="sendBtn">æŒ‰ä¸‹ è¯´è¯</span>
            </div>
            <div id="icon"><i class="material-icons">ğŸ˜†</i></div>
            <div id="add"><i class="material-icons">â•</i></div>
        </footer>
    </div>
</body>
â€‹
</html>
