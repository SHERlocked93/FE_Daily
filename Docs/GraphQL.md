# GraphQL ä»Žå…¥é—¨åˆ°å®žè·µ
[TOC]

## 1. æ¦‚è¿°

çŽ°åœ¨å‰ç«¯çš„å¼€å‘éšç€ SPA æ¡†æž¶çš„å…¨é¢æ™®åŠï¼Œç»„ä»¶åŒ–å¼€å‘ä¹Ÿéšä¹‹æˆä¸ºå¤§åŠ¿æ‰€è¶‹ï¼Œå„ä¸ªç»„ä»¶åˆ†åˆ«ç®¡ç†ç€å„è‡ªçš„çŠ¶æ€ã€‚å¦‚æžœ API ç²’åº¦æ¯”è¾ƒç²—çŠ·ï¼Œç»„ä»¶éœ€è¦æŠŠå¼‚æ­¥è¯·æ±‚çš„çŠ¶æ€åˆ†å‘ç»™å­ç»„ä»¶æˆ–é€šçŸ¥ç»™çˆ¶ç»„ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç”±ç»„ä»¶é—´é€šä¿¡å¸¦æ¥çš„ç»“æž„å¤æ‚åº¦ã€æ¥æºä¸æ˜Žçš„æ•°æ®æºã€ä¸çŸ¥ä»Žä½•è®¢é˜…çš„æ•°æ®å“åº”ä¼šä½¿å¾—æ•°æ®æµå˜å¾—æ‚ä¹±æ— ç« ï¼Œä¹Ÿä½¿å¾—ä»£ç å¯è¯»æ€§å˜å·®ï¼Œä»¥åŠå¯ç»´æŠ¤æ€§çš„é™ä½Žï¼Œä¸ºä»¥åŽé¡¹ç›®çš„è¿­ä»£å¸¦æ¥æžå¤§å›°éš¾ã€‚

è¯•æƒ³ä¸€ä¸‹ä½ éƒ½å¼€å‘å®Œäº†ï¼Œäº§å“å‘Šè¯‰ä½ è¦å¤§æ”¹ä¸€ç•ªï¼Œä»ŽæŽ¥å£åˆ°ç»„ä»¶ç»“æž„éƒ½å¾—æ”¹ï¼ŒåŽç«¯ä¹Ÿéª‚éª‚å’§å’§ä¸æ„¿é…åˆè®©ä½ ä»Žå¥½å‡ ä¸ª API é‡Œå–æ•°æ®è‡ªå·±ç»„åˆï¼Œè¿™é…¸çˆ½ ðŸ¤ª

åœ¨ä¸€äº›äº§å“é“¾å¤æ‚çš„åœºæ™¯ï¼ŒåŽç«¯éœ€è¦æä¾›å¯¹åº” WebAppã€WebPCã€APPã€å°ç¨‹åºã€å¿«åº”ç”¨ç­‰å„ç«¯ APIï¼Œæ­¤æ—¶ API çš„ç²’åº¦å¤§å°å°±æ˜¾å¾—æ ¼å¤–é‡è¦ï¼Œç²—ç²’åº¦ä¼šå¯¼è‡´ç§»åŠ¨ç«¯ä¸å¿…è¦çš„æµé‡æŸè€—ï¼Œç»†ç²’åº¦åˆ™ä¼šé€ æˆå‡½æ•°çˆ†ç‚¸ (Function Explosion)ï¼›åœ¨æ­¤æƒ…æ™¯ä¸‹ Facebook çš„å·¥ç¨‹å¸ˆäºŽ 2015 å¹´å¼€æºäº† **GraphQL** è§„èŒƒï¼Œè®©å®¢æˆ·ç«¯è‡ªå·±æè¿°è‡ªå·±å¸Œæœ›çš„æ•°æ®å½¢å¼ï¼ŒæœåŠ¡ç«¯åˆ™è¿”å›žå®¢æˆ·ç«¯æ‰€æè¿°çš„æ•°æ®ç»“æž„ã€‚

ç®€å•ä½¿ç”¨å¯ä»¥å‚ç…§ä¸‹é¢è¿™ä¸ªå›¾ï¼š

![](https://i.loli.net/2019/03/10/5c84b1dca1c5f.gif)

æ¯”å¦‚å‰ç«¯å¸Œæœ›è¿”å›žä¸€ä¸ª ID ä¸º `233` çš„ç”¨æˆ·çš„åç§°å’Œæ€§åˆ«ï¼Œå¹¶æŸ¥æ‰¾è¿™ä¸ªç”¨æˆ·çš„å‰åä¸ªé›‡å‘˜çš„åå­—å’Œ Emailï¼Œå†æ‰¾åˆ°è¿™ä¸ªäººçˆ¶äº²çš„ç”µè¯ï¼Œå’Œè¿™ä¸ªçˆ¶äº²çš„ç‹—çš„åå­—ï¼ˆåˆ«é—®æˆ‘ä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆå¥‡æ€ªçš„ä¾‹å­ ðŸ¤ªï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€æ¬¡ query æ‹¿åˆ°å…¨éƒ¨ä¿¡æ¯ï¼Œè€Œä¸éœ€ä»Žå¥½å‡ ä¸ªå¼‚æ­¥ API é‡Œé¢æ¥å›žæ‰¾ï¼š

```graphql
query {
  user (id : "233") {
    name
    gender
    employee (first: 10) {
      name
      email
    }
    father {
      telephone
      dog {
          name
      }
    }
  }
}
```

ç»è¿‡äº†å‡ å¹´ä¸€çº¿å¼€å‘è€…çš„å¡«å‘ï¼Œå·²ç»æœ‰ä¸€äº›ä¸é”™çš„[å·¥å…·é“¾](https://github.com/chentsulin/awesome-graphql)å¯ä»¥ä½¿ç”¨äºŽå¼€å‘ï¼Œå¾ˆå¤šè¯­è¨€ä¹Ÿæä¾›äº†å¯¹ GraphQL çš„æ”¯æŒï¼Œæ¯”å¦‚ JavaScript/Nodejsã€Javaã€PHPã€Rubyã€Pythonã€Goã€C# ç­‰ã€‚

ä¸€äº›æ¯”è¾ƒæœ‰åçš„å…¬å¸æ¯”å¦‚ Twitterã€IBMã€Courseraã€Facebookã€Githubã€æºç¨‹ç­‰ï¼Œå†…éƒ¨ç”šè‡³æ˜¯å¤–éƒ¨ API ä¹Ÿä»Ž RESTful è½¬ä¸ºäº† GraphQL é£Žæ ¼ï¼Œç‰¹åˆ«æ˜¯ Githubï¼Œå®ƒçš„ v4 ç‰ˆå¤–éƒ¨ API åªä½¿ç”¨ GraphQLã€‚

## 2. è¯­æ³•

æ›´è¯¦ç»†çš„å†…å®¹å‚è€ƒä¸€ä¸‹ [GraphQL](http://graphql.cn/learn/queries/#directives) å®˜ç½‘æ–‡æ¡£ï¼Œè¿™é‡Œä»‹ç»å‡ ä¸ªå¯¹ç†è§£ GraphQL æ¯”è¾ƒé‡è¦çš„æ¦‚å¿µ

### 2.1 å‡ ä¸ªé‡è¦æ¦‚å¿µ

#### 1. æ“ä½œç±»åž‹ Operation Type

GraphQL çš„æ“ä½œç±»åž‹å¯ä»¥æ˜¯ `query`ã€`mutation` æˆ– `subscription`ï¼Œæè¿°äº†å®¢æˆ·ç«¯å¸Œæœ›è¿›è¡Œä»€ä¹ˆæ ·çš„æ“ä½œ

1. query æŸ¥è¯¢ï¼šèŽ·å–æ•°æ®ï¼Œæ¯”å¦‚æŸ¥æ‰¾ï¼ŒCRUD ä¸­çš„ R
2. mutation å˜æ›´ï¼šå¯¹æ•°æ®è¿›è¡Œå˜æ›´ï¼Œæ¯”å¦‚å¢žåŠ ã€åˆ é™¤ã€ä¿®æ”¹ï¼ŒCRUD ä¸­çš„ CUD
3. substription è®¢é˜…ï¼šå½“æ•°æ®å‘ç”Ÿæ›´æ”¹ï¼Œè¿›è¡Œæ¶ˆæ¯æŽ¨é€

è¿™äº›æ“ä½œç±»åž‹éƒ½å°†åœ¨åŽæ–‡çš„ç”¨åˆ°

#### 2. å¯¹è±¡ç±»åž‹å’Œæ ‡é‡ç±»åž‹ Object Type & Scalar Type

å¦‚æžœä¸€ä¸ª GraphQL æœåŠ¡æŽ¥å—åˆ°äº†ä¸€ä¸ª `query`ï¼Œé‚£ä¹ˆè¿™ä¸ª `query` å°†ä»Ž `Root Query` å¼€å§‹æŸ¥æ‰¾ï¼Œæ‰¾åˆ°å¯¹è±¡ç±»åž‹ï¼ˆObject Typeï¼‰æ—¶åˆ™ä½¿ç”¨å®ƒçš„è§£æžå‡½æ•° (Resolver) æ¥èŽ·å–å†…å®¹ï¼Œå¦‚æžœè¿”å›žçš„æ˜¯å¯¹è±¡ç±»åž‹åˆ™ç»§ç»­ä½¿ç”¨è§£æžå‡½æ•°èŽ·å–å†…å®¹ï¼Œå¦‚æžœè¿”å›žçš„æ˜¯æ ‡é‡ç±»åž‹ï¼ˆScalar Typeï¼‰åˆ™ç»“æŸèŽ·å–ï¼Œç›´åˆ°æ‰¾åˆ°æœ€åŽä¸€ä¸ªæ ‡é‡ç±»åž‹ã€‚

1. å¯¹è±¡ç±»åž‹ï¼šç”¨æˆ·åœ¨ schema ä¸­å®šä¹‰çš„ `type`
2. æ ‡é‡ç±»åž‹ï¼šGraphQL ä¸­å†…ç½®æœ‰ä¸€äº›æ ‡é‡ç±»åž‹ `String`ã€`Int`ã€`Float`ã€`Boolean`ã€`ID`ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„æ ‡é‡ç±»åž‹

æ¯”å¦‚åœ¨ Schema ä¸­å£°æ˜Ž

```graphql
type User {
  name: String!
  age: Int
}
```

è¿™ä¸ª `User` å¯¹è±¡ç±»åž‹æœ‰ä¸¤ä¸ªå­—æ®µï¼Œname å­—æ®µæ˜¯ä¸€ä¸ªä¸º `String` çš„éžç©ºæ ‡é‡ï¼Œage å­—æ®µä¸ºä¸€ä¸ª `Int` çš„å¯ç©ºæ ‡é‡ã€‚

#### 3. æ¨¡å¼ Schema

å¦‚æžœä½ ç”¨è¿‡ MongoOSEï¼Œé‚£ä½ åº”è¯¥å¯¹ schema è¿™ä¸ªæ¦‚å¿µå¾ˆç†Ÿæ‚‰ï¼Œ





## å®žæˆ˜

ç›®å‰å‰åŽç«¯çš„ç»“æž„å¤§æ¦‚å¦‚ä¸‹å›¾ã€‚åŽç«¯é€šè¿‡ DAO å±‚ä¸Žæ•°æ®åº“è¿žæŽ¥ï¼ŒæœåŠ¡äºŽä¸»è¦å¤„ç†ä¸šåŠ¡é€»è¾‘çš„ Service å±‚ï¼Œä¸º Controller å±‚æä¾›æ•°æ®æºå¹¶äº§å‡º APIï¼›å‰ç«¯é€šè¿‡æµè§ˆå™¨ URL è¿›è¡Œè·¯ç”±å‘½ä¸­èŽ·å–ç›®æ ‡è§†å›¾çŠ¶æ€ï¼Œè€Œé¡µé¢è§†å›¾æ˜¯ç”±ç»„ä»¶åµŒå¥—ç»„æˆï¼Œæ¯ä¸ªç»„ä»¶ç»´æŠ¤ç€å„è‡ªçš„ç»„ä»¶çº§çŠ¶æ€ï¼Œä¸€äº›ç¨å¾®å¤æ‚çš„åº”ç”¨è¿˜ä¼šä½¿ç”¨é›†ä¸­å¼çŠ¶æ€ç®¡ç†çš„å·¥å…·ï¼Œæ¯”å¦‚ Vuexã€Reduxã€Mobx ç­‰ã€‚å‰åŽç«¯åªé€šè¿‡ API æ¥äº¤æµï¼Œè¿™ä¹Ÿæ˜¯çŽ°åœ¨å‰åŽç«¯åˆ†ç¦»å¼€å‘çš„åŸºç¡€ã€‚

![](https://i.loli.net/2019/03/08/5c82222d15d80.png)











---
ç½‘ä¸Šçš„å¸–å­å¤§å¤šæ·±æµ…ä¸ä¸€ï¼Œç”šè‡³æœ‰äº›å‰åŽçŸ›ç›¾ï¼Œåœ¨ä¸‹çš„æ–‡ç« éƒ½æ˜¯å­¦ä¹ è¿‡ç¨‹ä¸­çš„æ€»ç»“ï¼Œå¦‚æžœå‘çŽ°é”™è¯¯ï¼Œæ¬¢è¿Žç•™è¨€æŒ‡å‡º~



> å‚è€ƒï¼š
>
> 1. [GraphQL \| ä¸€ç§ä¸ºä½ çš„ API è€Œç”Ÿçš„æŸ¥è¯¢è¯­è¨€](http://graphql.cn/)
> 2. [JSON\-RPC 2\.0 è§„èŒƒ \- wiki \. leozvc](http://wiki.geekdream.com/Specification/json-rpc_2.0.html)
> 3. [GraphQL ä¸ºä½•æ²¡æœ‰ç«èµ·æ¥? - å°¤é›¨æºªçš„å›žç­” - çŸ¥ä¹Ž](https://www.zhihu.com/question/38596306/answer/79714979)
> 4. [GraphQLä»€ä¹ˆé¬¼ \| kazaff's blog](https://blog.kazaff.me/2016/01/01/GraphQL%E4%BB%80%E4%B9%88%E9%AC%BC/)
